(function(a){a.smartLoader={version:"0.1.0",modules:[],events:[],scope:[],scripts:[],stylesheets:[],modulesCount:0,loadedModulesCount:0,options:{baseElement:null,baseUrl:null,paths:{scripts:"scripts/"},noCache:false},init:function(b){if(this.isInit){return false;
}this.isInit=true;this.getUserAgent();this.setOptions(b);if(this.options.baseUrl===null){this.options.baseUrl=this.getBaseUrl();}this.Events.init();},loadMain:function(){var c=document.getElementsByTagName("script");
for(var d=c.length-1;d>=0;d--){var f=c[d].src;if(f.match(/smartLoader(.*)(.js)/)){var b=c[d].getAttribute("data-main"),e=this;if(b){if(!this.isAbsoluteUrl(b)){b=this.getBaseUrl(c[d])+"/"+b+".js";
}this.loadScript(b,function(){e.init.call(e);});}break;}}},setOptions:function(b,d){if(!d){d=this.options;}if(b){for(var c in b){if(b.hasOwnProperty(c)){if(Object.prototype.toString.call(b[c])=="[object Object]"&&b[c]!==null){d[c]=this.setOptions(b[c],d[c]);
}else{d[c]=b[c];}}}}return d;},getBaseUrl:function(b){if(b){return b.src.split("/").slice(0,-1).join("/");}else{var c=document.getElementsByTagName("script");
for(var d=c.length-1;d>=0;d--){var e=c[d].src;if(e.match(/smartLoader(.*)(.js)/)){return e.split("/").slice(0,-1).join("/");}}return"";}},getUserAgent:function(){var d=navigator.userAgent;
this.browser={name:"unknown",version:null};var b;if(/Firefox\//.test(d)){this.browser.name="firefox";b="Firefox";}else{if(/MSIE/.test(d)){this.browser.name="ie";
b="MSIE";}else{if(/Chrome/.test(d)){this.browser.name="chrome";b="Chrome";}else{if(/AppleWebKit/.test(d)){this.browser.name="safari";b="Version";}else{if(/Opera/.test(d)){this.browser.name="opera";
b="Version";}else{if(/Gecko/.test(d)){this.browser.name="gecko";b="rv";}else{return;}}}}}}var c=d.indexOf(b);if(c!==-1){this.browser.version=parseFloat(d.substring(c+b.length+1));
}return this.browser;},getLoadedFiles:function(){var b=document.getElementsByTagName("script");for(var c=0;c<b.length;c++){if(!!b[c].src){this.loadedFiles[b[c].src]="loaded";
}}},loadScript:function(d,f,c){if(!d){return;}var b=document.createElement("script");b.setAttribute("type","text/javascript");if(this.options.noCache===false){b.setAttribute("src",d);
}else{var e=d.indexOf("?")>0?"&":"?";e+="noCache="+new Date().getTime();b.setAttribute("src",d+e);}me=this;if(typeof(f)=="function"){if(b.readyState){b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete"){b.onreadystatechange=null;
f(d);}};}else{b.onload=function(){f(d);};}}this.insertElement(b,c);},loadCSS:function(k,j,i){if(!k){return;}var g=document.createElement("link");g.setAttribute("type","text/css");
g.setAttribute("rel","stylesheet");if(this.options.noCache===false){g.setAttribute("href",k);}else{var f=k.indexOf("?")>0?"&":"?";f+="noCache="+new Date().getTime();
g.setAttribute("href",k+f);}me=this;if(typeof(j)=="function"){if(g.readyState){g.onreadystatechange=function(){if(g.readyState=="loaded"||g.readyState=="complete"){g.onreadystatechange=null;
j(k);}};}else{if(this.browser.name=="safari"||(this.browser.name=="firefox"&&this.browser.version<=4)){var d=document.styleSheets.length;var b=50;var c=new Date().getTime();
var h=1000;var e=function(p){var l=false;var o=document.styleSheets.length;if(o>d){var n=p.options.noCache?k+f:k;n=p.makeAbsoluteUrl(n);for(var m=o-1;m>=d;
m--){if(document.styleSheets[m].href==n){l=true;break;}}}if(l){j(k);}else{if(new Date().getTime()<c+h){setTimeout(function(){e(p);},b);}}};setTimeout(function(){e(me);
},b);}else{g.onload=function(){j(k);};}}}this.insertElement(g,i);},insertElement:function(d,c){var b=document.getElementsByTagName("head")[0];c=c||this.options.baseElement;
if(c){c=typeof(c)=="string"?document.getElementById(c):c;try{b=c.parentNode;}catch(f){}}b.insertBefore(d,c);},initModule:function(b){if(!this.modules[b]){this.modulesCount++;
this.modules[b]={};}this.modules[b]={name:b,status:this.modules[b].status||null,dependency:this.modules[b].dependency||[],files:this.modules[b].files||{count:0,loaded:0}};
},loadModule:function(b,n){if(typeof(b)=="function"||typeof(b)=="object"){n=b;b=n.name||"mod-"+(this.modules.length+1);}this.initModule(b);if(typeof(n)=="function"){if(this.isModuleLoaded(b,true)===false&&this.isModuleLoaded(this.getDependencies(b))){this.modules[b].status="loaded";
n.apply(self,this.getScopes(b));this.setModuleReady(b);}}else{var e={scripts:null,styles:null,async:true,dependency:null,usePath:null,insertBefore:null,onStart:null,onComplete:null};
n=this.setOptions(n,e);if(n.dependency!==null&&this.isModuleLoaded(n.dependency)===false&&this.isModuleOnQueue(b)===false){this.onModuleReady(n.dependency,b,n);
return;}else{if(n.dependency!==null&&this.isModuleLoaded(n.dependency)===true&&this.isModuleOnQueue(b)===false){this.saveDependency(b,n.dependency);}}if(this.isModuleOnQueue(b)===false||(this.isModuleLoaded(this.getDependencies(b))===true&&this.isModuleLoaded(b,true)===false)){this.modules[b].status="loading";
if(typeof(n.onStart)=="function"){n.onStart.apply(this.modules[b],this.getScopes(b,true));}var l=this;var h=function(p){if(l.isAbsoluteUrl(p)===false){var i=l.options.baseUrl;
if(i&&!i.match(/\/$/)){i+="/";}if(n.usePath&&l.options.paths[n.usePath]){i+=l.options.paths[n.usePath];if(!i.match(/\/$/)){i+="/";}}p=i+p;}return p;};var o=function(i){l.modules[b].files.loaded++;
if(l.modules[b].files.loaded==l.modules[b].files.count){c();l.setModuleReady(b);}};var c=function(){if(typeof(n.onComplete)=="function"){n.onComplete.apply(l.modules[b],l.getScopes(b));
}};if(typeof(n.styles)=="object"&&n.styles!==null){var d=n.styles.length;this.modules[b].files.count+=d;for(var g=0;g<d;g++){this.loadCSS(h(n.styles[g]),o,n.insertBefore);
}}else{if(typeof(n.styles)=="string"){this.modules[b].files.count++;this.loadCSS(h(n.styles),o,n.insertBefore);}}if(typeof(n.scripts)=="object"&&n.scripts!==null){var k=0;
var j=n.scripts.length;this.modules[b].files.count+=j;var f=function(){if(k<j){var i=h(n.scripts[k]);l.scripts[i]=b;if(n.async===false){l.loadScript(i,function(){o();
k++;f();},n.insertBefore);}else{l.loadScript(i,o,n.insertBefore);k++;f();}}};f();}else{if(typeof(n.scripts)=="string"){var m=h(n.scripts);this.scripts[m]=b;
this.modules[b].files.count++;this.loadScript(m,o,n.insertBefore);}}if(n.styles===null&&n.scripts===null){c();this.setModuleReady(b);}}}},isModuleLoaded:function(c,d){if(Object.prototype.toString.call(c)=="[object Array]"){return this.areModulesLoaded(c,d);
}else{var b=this.modules[c]?this.modules[c].status:null;if(b=="loaded"){return true;}else{if(b=="loading"&&d===true){return true;}else{if(c){return false;
}else{return true;}}}}},areModulesLoaded:function(c,e){var b=true;for(var d=0;d<c.length;d++){if(this.isModuleLoaded(c[d],e)===false){b=false;break;}}return b;
},isModuleOnQueue:function(c){var b=this.modules[c]?this.modules[c].status:null;if(b=="loaded"||b=="loading"||b=="queued"){return true;}else{return false;
}},isEventReady:function(b){if(this.events[b]===true){return true;}else{return false;}},addPath:function(b,c){this.options.paths[b]=c;},onLoad:function(c,b){if(this.isEventReady("load")){this.loadModule(c,b);
}else{var d=this;this.Events.suscribe("load",function(){d.loadModule(c,b);});}},onUserReady:function(c,b){if(this.isEventReady("userReady")){this.loadModule(c,b);
}else{var d=this;this.Events.suscribe("userReady",function(){d.loadModule(c,b);d.Events.unsuscribe("userReady");});}},onModuleReady:function(e,c,b){if(typeof(c)=="function"||typeof(c)=="object"){b=c;
c=b.name||b;}this.saveDependency(c,e);if(this.isModuleLoaded(e)){this.loadModule(c,b);}else{var g=this;this.modules[c].status="queued";var f=e;if(typeof(e)=="string"){e=[e];
}for(var h in e){this.Events.suscribe("moduleReady:"+e[h],function(){g.loadModule(c,b);});}}if(typeof(c)=="function"||typeof(b)=="function"){this.modules[c].dependency=e;
}},getDependencies:function(b){return this.modules[b].dependency;},saveDependency:function(c,b){this.initModule(c);this.modules[c].dependency=this.modules[c].dependency.concat(b);
},setModuleReady:function(b){this.modules[b].status="loaded";this.loadedModulesCount++;this.Events.fire("moduleReady:"+b);},setScope:function(b,c){if(typeof(b)!="string"){c=b;
b=this.getModuleFromScript();}if(typeof(c)=="function"){c=c.apply(self,this.getScopes(b,true));}this.scope[b]=c||this.scope[b];},getScope:function(b){return this.scope[b];
},getScopes:function(c,b){var e=b?[]:[this.getScope(c)];if(this.modules[c]){for(var d=0;d<this.modules[c].dependency.length;d++){e.push(this.getScope(this.modules[c].dependency[d]));
}}return e;},getModuleFromScript:function(c){if(!c){var b=document.getElementsByTagName("head")[0].getElementsByTagName("script");c=b[b.length-1].getAttribute("src");
}return this.scripts[c];},isAbsoluteUrl:function(c,b){if(c.match(/(http:|https:|ftp:)/)||(c[0]=="/"&&!b)){return true;}else{return false;}},makeAbsoluteUrl:function(e){if(this.isAbsoluteUrl(e)){return e;
}var d=e.split("/");var f=window.location.pathname.split("/");f.pop();for(var b=0;b<d.length;b++){if(d[b]==".."){f.pop();}else{f.push(d[b]);}}var c=window.location.origin+(f.join("/"));
return c;},count:function(b){return b?this.loadedModulesCount:this.modulesCount;},Events:{handlers:[],init:function(){var e=this;var d=function(f){a.smartLoader.events.load=true;
e.fire("load",f);};if(document.readyState=="complete"){d();}else{this.addEvent("load",d);}var c=function(f){a.smartLoader.events.userReady=true;e.fire("userReady",f);
};var b=["keydown","mousemove","mousedown"];this.addEvents(b,c);},suscribe:function(c,b){if(typeof(this.handlers[c])=="undefined"){this.handlers[c]=[];
}this.handlers[c].push(b);},unsuscribe:function(d,c){if(!this.handlers[d]){return;}if(c){var b=this.handlers[d].indexOf(c);if(b>-1){this.handlers[d].splice(b,1);
}}else{this.handlers[d]=null;}},fire:function(d,e){var b=this.handlers[d];if(b){for(var c in b){if(b.hasOwnProperty(c)){if(typeof(b[c])=="function"){b[c](e);
}}}}},addEvent:function(c,e){var d="on"+c;if(typeof(window[d])!="undefined"){if(typeof(window.addEventListener)!="undefined"){window.addEventListener(c,e,false);
}else{if(typeof(window.attachEvent)!="undefined"){window.attachEvent(d,e);}else{if(window[d]!==null){var b=window[d];window[d]=function(f){b(f);window[e]();
};}else{window[d]=e;}}}}else{if(typeof(document[d])!="undefined"){if(typeof(document.addEventListener)!="undefined"){document.addEventListener(c,e,false);
}else{if(typeof(document.attachEvent)!="undefined"){document.attachEvent(d,e);}else{if(document[d]!==null){var b=document[d];document[d]=function(f){b(f);
document[e]();};}else{document[d]=e;}}}}else{}}},addEvents:function(c,d){for(var b=0;b<c.length;b++){this.addEvent(c[b],d);}}}};a.smartLoader.Events.addEvent("load",function(){a.smartLoader.loadMain();
});})(window);